node('jenkins-slave') {
     stage('build pipeline') {
        sh(script: """
           git clone https://github.com/Elros-Virtual/ts-portfolio.git
           
           cd ./ts-portfolio/toby-site

           docker login -u mranarion  -p AN2479dy7881

           docker build -f toby-site.dockerfile -t elrosvirtual/ts-portfolio:3 . --no-cache

           docker push elrosvirtual/ts-portfolio:3

        """)
    }

      stage('deploy pipeline') {
        sh(script: """      
           git clone https://github.com/Elros-Virtual/infrastructure.git

           cd ./kubernetes/deployments/toby-site/
           
           sed -i 's/ts-portfolio:2/ts-portfolio:3/g' toby-site.yaml
           
           git config user.email 'iar31.roberts@gmail.com'
           
           git config user.name 'iar31.roberts@gmail.com'
           
           git commit -a -m "updating tag"
           
           git push https://password:username@github.com/Elros-Virtual/infrastructure.git
           
        """)
    }
}